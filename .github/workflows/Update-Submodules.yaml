name: Update Submodules

on:
  schedule:
    - cron: '0 0,6,12,18 * * *' # 6시간 간격 실행
  workflow_dispatch:

jobs:
  update-submodules:
    runs-on: ubuntu-latest
    steps:
      # UTF-8 로케일 및 Git 경로 설정
      - name: Set UTF-8 locale and fix encoding
        run: |
          sudo locale-gen ko_KR.UTF-8
          export LANG=ko_KR.UTF-8
          export LANGUAGE=ko_KR.UTF-8
          export LC_ALL=ko_KR.UTF-8
          git config --global core.precomposeUnicode true
          git config --global core.quotepath false

      # 디렉토리 디버깅 (선택적)
      - name: Debug directory structure
        run: |
          ls -al /home/runner/work/ssafy13-team2/ssafy13-team2/

      # 중앙 레포지토리와 서브모듈 체크아웃
      - name: Checkout central repository
        uses: actions/checkout@v3
        with:
          submodules: true  # 서브모듈 포함
          fetch-depth: 0

      # 서브모듈 동기화 및 업데이트
      - name: Sync and update submodules
        run: |
          git submodule sync --recursive
          git submodule update --init --recursive
          if [ -z "$(git status --porcelain)" ]; then
            echo "No changes in submodules. Exiting."
            exit 0
          fi

      # 변경 사항 커밋 및 푸시
      - name: Commit and push changes
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          CURRENT_DATE=$(date "+%Y년 %m월 %d일 %H시 %M분")
          git add .
          git commit -m "서브모듈 업데이트: $CURRENT_DATE"
          git push
